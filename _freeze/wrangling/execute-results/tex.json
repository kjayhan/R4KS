{
  "hash": "8374dfe5cfbbe3ae3141c0013291b971",
  "result": {
    "engine": "knitr",
    "markdown": "# Data Wrangling\n\nIn this chapter, we will learn how to wrangle data mainly using the `dplyr` package. We will learn how to select, filter, arrange, mutate, group, and summarize data. We will learn how to join data from different sources, working with dates, and converting data to long and wide formats.\n\nAs an example for this chapter, we will use Korea's trade data, [`trade_data`](https://kdiplo.com/reference/trade_data), from the [`kdiplo`](https://github.com/kjayhan/kdiplo/) package. Let's install the package. You can install the development version from GitHub with:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"devtools\") # if you haven't installed the devtools package yet, remove the # sign.\n\ndevtools::install_github(\"kjayhan/kdiplo\")\n```\n:::\n\n\n\nLet's load the libraries and the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # load the tidyverse package which includes dplyr, ggplot2, tidyr, readr, purrr, and tibble and more.\n\nlibrary(kdiplo) # load the kdiplo package\n```\n:::\n\n\n\nLet's take a quick look at the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(trade_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 18\n  iso3c country  year export import total_export total_import export_kosis\n  <chr> <chr>   <dbl>  <dbl>  <dbl>        <dbl>        <dbl>        <dbl>\n1 ABW   Aruba    1965     NA     NA    175082000    463442000           NA\n2 ABW   Aruba    1966     NA     NA    250334000    716441000           NA\n3 ABW   Aruba    1967     NA     NA    320229000    996246000           NA\n4 ABW   Aruba    1968     NA     NA    455400000   1462873000           NA\n5 ABW   Aruba    1969     NA     NA    622516000   1823611000           NA\n6 ABW   Aruba    1970     NA     NA    835185000   1983973000           NA\n# i 10 more variables: import_kosis <dbl>, export_cow <dbl>, import_cow <dbl>,\n#   index <dbl>, cpi <dbl>, export_cons_2015 <dbl>, import_cons_2015 <dbl>,\n#   total_export_cons_2015 <dbl>, total_import_cons_2015 <dbl>,\n#   updated_at <date>\n```\n\n\n:::\n:::\n\n\n\nWe can read the data's documentation using the `?` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n?trade_data\n```\n:::\n\n\n\nLet's assign the data to a new object.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_data <- trade_data\n```\n:::\n\n\n\n## Selecting columns\n\nWe do not need all the columns in the data. We can select the columns we need using the `select()` function. For now, I will select only five columns: `iso3c` (country code), `country` (country name), `year` (year), `export_kosis` (Korea's exports as reported by Korean Statistical Information Service (KOSIS)), and `import_kosis` (Korea's exports as reported by KOSIS).\n\nWe can either assign the updated object with the selected columns to the same object or a new object. Here, I will assign the updated object to a new object.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade_data |>\n  select(iso3c, country, year, export_kosis, import_kosis)\n```\n:::\n\n\n\nLet's see how many rows and columns `trade_data` and `trade` have.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(trade_data) # number of rows in trade_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 16511\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nncol(trade_data) # number of columns in trade_data\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 18\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(trade) # number of rows in trade\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 16511\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nncol(trade) # number of columns in trade\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5\n```\n\n\n:::\n:::\n\n\n\n`trade_data` has 16511 rows and 18 columns. `trade` has 16511 rows and 5 columns.\n\n## Filtering rows\n\nWe can filter rows based on a condition using the `filter()` function. Here, I will filter rows where the year is larger than 1964. Indeed, KOSIS data starts from 1965. This time, I will assign the updated object to the same object. We need a condition for filtering. In this case, the condition is `year > 1964`. It is the same as `year >= 1965`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade |>\n  filter(year > 1964)\n```\n:::\n\n\n\nLet's create a new object with the data from only 2019. `==` is the condition for equality. We need to use `==` instead of `=` for equality condition, and we need to be careful about it.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_2019 <- trade |>\n  filter(year == 2019)\n\n# let's see what the data looks like:\nhead(trade_2019)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 5\n  iso3c country        year export_kosis import_kosis\n  <chr> <chr>         <dbl>        <dbl>        <dbl>\n1 ABW   Aruba          2019     10396000         1000\n2 AFG   Afghanistan    2019     49930000        38000\n3 AGO   Angola         2019    236830000     16733000\n4 AIA   Anguilla       2019       817000         1000\n5 ALA   Åland Islands  2019           NA            0\n6 ALB   Albania        2019     20744000      3357000\n```\n\n\n:::\n:::\n\n\n\nLet's create a new object with the data from only three countries: United States, China, and Japan. We need to use `%in%` as a condition for multiple values that we look for in the dataframe.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_us_china_japan <- trade |>\n  filter(country %in% c(\"United States\", \"China\", \"Japan\"))\n\n# let's see what the data looks like:\nhead(trade_us_china_japan)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 5\n  iso3c country  year export_kosis import_kosis\n  <chr> <chr>   <dbl>        <dbl>        <dbl>\n1 CHN   China    1965           NA           NA\n2 CHN   China    1966           NA           NA\n3 CHN   China    1967           NA           NA\n4 CHN   China    1968           NA           NA\n5 CHN   China    1969           NA           NA\n6 CHN   China    1970           NA           NA\n```\n\n\n:::\n:::\n\n\n\nWe can filter the rows for multiple years using the `%in%` operator as well. Let's create a new object with the data from 2015, 2016, 2017, and 2018. `:` is used to create a sequence of numbers. `2015:2018` creates a sequence of numbers from 2015 to 2018.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_2015_2018 <- trade |>\n  filter(year %in% 2015:2018)\n```\n:::\n\n\n\nWe can also filter rows based on multiple conditions. Let's create a new object with the data from 2015, 2016, 2017, and 2018 using the `&` operator, which means \"and\".\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_2015_2018_backup <- trade |>\n  filter(year >= 2015 # year is greater than or equal to 2015\n         & # and\n         year <= 2018 # year is less than or equal to 2018\n         )\n```\n:::\n\n\n\nLet's check if `trade_2015_2018` and `trade_2015_2018_backup` are the same.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nidentical(trade_2015_2018, trade_2015_2018_backup)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\n\nNow, let's filter the data for 2015, 2016, 2017, and 2018 for the United States, China, and Japan, this time using country codes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_us_china_japan_2015_2018 <- trade |>\n  filter(year %in% 2015:2018 # included years are 2015, 2016, 2017, and 2018\n         & # and\n         iso3c %in% c(\"USA\", \"CHN\", \"JPN\") # included country codes are USA, CHN, and JPN\n         )\n\n# let's see what the data looks like:\nhead(trade_us_china_japan_2015_2018)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 5\n  iso3c country  year export_kosis import_kosis\n  <chr> <chr>   <dbl>        <dbl>        <dbl>\n1 CHN   China    2015 137123934000  90250275000\n2 CHN   China    2016 124432941000  86980135000\n3 CHN   China    2017 142120000000  97860114000\n4 CHN   China    2018 162125055000 106488592000\n5 JPN   Japan    2015  25576507000  45853834000\n6 JPN   Japan    2016  24355036000  47466592000\n```\n\n\n:::\n:::\n\n\n\nTwo other operators that we can use for filtering are `|` and `!`. `|` means \"or\" and `!` means \"not\". Let's create a new object with the data for 2015, 2016, 2017, and 2018 or the export volume is larger than 100 billion USD.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_2015_2018_or_export <- trade |>\n  filter(year %in% 2015:2018 # included years are 2015, 2016, 2017, and 2018\n         | #or\n         export_kosis > 110000000000 # export volume is larger than 110 billion USD\n         )\n```\n:::\n\n\n\nLet's see what else is included that is not in the years 2015, 2016, 2017, and 2018.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_2015_2018_or_export |>\n  filter(!year %in% 2015:2018) #  excluded years are 2015, 2016, 2017, and 2018\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 11 x 5\n   iso3c country        year export_kosis import_kosis\n   <chr> <chr>         <dbl>        <dbl>        <dbl>\n 1 CHN   China          2010 116837833000  71573603000\n 2 CHN   China          2011 134185009000  86432238000\n 3 CHN   China          2012 134322564000  80784595000\n 4 CHN   China          2013 145869498000  83052877000\n 5 CHN   China          2014 145287701000  90082226000\n 6 CHN   China          2019 136202533000 107228736000\n 7 CHN   China          2020 132565445000 108884645000\n 8 CHN   China          2021 162912974000 138628127000\n 9 CHN   China          2022 155789389000 154576314000\n10 CHN   China          2023 124817682000 142857338000\n11 USA   United States  2023 115696334000  71272030000\n```\n\n\n:::\n:::\n\n\n\n## Arranging rows\n\nWe can arrange rows based on a column using the `arrange()` function. Let's arrange the data by year in ascending order.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade |>\n  arrange(year)\n\nhead(trade)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 5\n  iso3c country        year export_kosis import_kosis\n  <chr> <chr>         <dbl>        <dbl>        <dbl>\n1 ABW   Aruba          1965           NA           NA\n2 AFG   Afghanistan    1965           NA           NA\n3 AGO   Angola         1965           NA           NA\n4 AIA   Anguilla       1965           NA           NA\n5 ALA   Åland Islands  1965           NA           NA\n6 ALB   Albania        1965           NA           NA\n```\n\n\n:::\n:::\n\n\n\nWe can arrange by year in descending order.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade |>\n  arrange(desc(year))\n\nhead(trade)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 5\n  iso3c country        year export_kosis import_kosis\n  <chr> <chr>         <dbl>        <dbl>        <dbl>\n1 ABW   Aruba          2023     21005000       121000\n2 AFG   Afghanistan    2023     25079000      1045000\n3 AGO   Angola         2023    474761000        11000\n4 AIA   Anguilla       2023        96000        10000\n5 ALA   Åland Islands  2023        15000            0\n6 ALB   Albania        2023    142311000     11053000\n```\n\n\n:::\n:::\n\n\n\nWe can arrange alphabetically by country codes in ascending order.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade |>\n  arrange(iso3c)\n\nhead(trade)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 5\n  iso3c country  year export_kosis import_kosis\n  <chr> <chr>   <dbl>        <dbl>        <dbl>\n1 ABW   Aruba    2023     21005000       121000\n2 ABW   Aruba    2022     24954000        15000\n3 ABW   Aruba    2021     11612000     93314000\n4 ABW   Aruba    2020      3070000     83864000\n5 ABW   Aruba    2019     10396000         1000\n6 ABW   Aruba    2018     14807000      2935000\n```\n\n\n:::\n:::\n\n\n\n## Mutating columns\n\nWe can create new columns or update existing columns using the `mutate()` function. Let's create a new column, `trade_kosis`, which is the total trade volume of Korea with a country in a year. The total trade volume is the sum of exports and imports.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade |>\n  mutate(trade_kosis = export_kosis + import_kosis)\n\nhead(trade)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 6\n  iso3c country  year export_kosis import_kosis trade_kosis\n  <chr> <chr>   <dbl>        <dbl>        <dbl>       <dbl>\n1 ABW   Aruba    2023     21005000       121000    21126000\n2 ABW   Aruba    2022     24954000        15000    24969000\n3 ABW   Aruba    2021     11612000     93314000   104926000\n4 ABW   Aruba    2020      3070000     83864000    86934000\n5 ABW   Aruba    2019     10396000         1000    10397000\n6 ABW   Aruba    2018     14807000      2935000    17742000\n```\n\n\n:::\n:::\n\n\n\n## Grouping and summarizing data\n\nWe can group data based on one or more columns using the `group_by()` function. We can summarize data based on the groups using the `summarize()` function. Let's group the data by year and summarize the total trade volume of Korea in each year.\n\nWe need to be careful about one thing. There are missing values in the data. We need to ignore them (in other words treat them as zero) when we calculate the total trade volume. Otherwise, the total trade volume will be `NA` if there is at least one missing value in the data for a year. We can use the `na.rm = TRUE` argument in the `sum()` function to remove missing values.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_volume <- trade |>\n  group_by(year) |>\n  summarize(total_trade_kosis = sum(trade_kosis, na.rm = TRUE)) |>\n  arrange(desc(total_trade_kosis))\n\nhead(trade_volume)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 2\n   year total_trade_kosis\n  <dbl>             <dbl>\n1  2022     1400216998000\n2  2023     1270073156000\n3  2021     1248778081000\n4  2018     1127928070000\n5  2014     1092728073000\n6  2011     1077938860000\n```\n\n\n:::\n:::\n\n\n\nWe can also group the data by country. Let's summarize the total trade volume of Korea with each country since 1965.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_country <- trade |>\n  group_by(country) |>\n  summarize(total_trade_kosis = sum(trade_kosis, na.rm = TRUE)) |>\n  arrange(desc(total_trade_kosis))\n\nhead(trade_country)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 2\n  country             total_trade_kosis\n  <chr>                           <dbl>\n1 China                   4455699092000\n2 United States           3179689314000\n3 Japan                   2424243884000\n4 Vietnam                  773845848000\n5 Hong Kong SAR China      759431632000\n6 Saudi Arabia             753711941000\n```\n\n\n:::\n:::\n\n\n\n## Conditional Mutating\n\nWe can conditionally mutate columns using the `case_when()` function. Let's create a new column, `trade_status`, which is \"surplus\" if the export volume is larger than the import volume, \"deficit\" if the import volume is larger than the export volume, and \"balanced\" if the export volume is equal to the import volume. If the export or import volume is missing, we will make the trade status \"unknown\". We can use `is.na()` to check if a value is missing.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- trade |>\n  mutate(trade_status = case_when(\n    export_kosis > import_kosis ~ \"surplus\", # export volume is larger than import volume\n    export_kosis < import_kosis ~ \"deficit\", # export volume is less than import volume\n    export_kosis == import_kosis ~ \"balanced\", # export volume is equal to import volume\n    is.na(export_kosis) | is.na(import_kosis) ~ \"unknown\", # export or import volume is missing\n    TRUE ~ \"everything else\" # in this instance, we do not need \"TRUE ~\" since we cover all `case_when()` options above. But in other cases, you may need it. \"TRUE ~\" basically helps you assign a new value for every other condition that is not mentioned above.\n  ))\n\nhead(trade)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 7\n  iso3c country  year export_kosis import_kosis trade_kosis trade_status\n  <chr> <chr>   <dbl>        <dbl>        <dbl>       <dbl> <chr>       \n1 ABW   Aruba    2023     21005000       121000    21126000 surplus     \n2 ABW   Aruba    2022     24954000        15000    24969000 surplus     \n3 ABW   Aruba    2021     11612000     93314000   104926000 deficit     \n4 ABW   Aruba    2020      3070000     83864000    86934000 deficit     \n5 ABW   Aruba    2019     10396000         1000    10397000 surplus     \n6 ABW   Aruba    2018     14807000      2935000    17742000 surplus     \n```\n\n\n:::\n:::\n\n\n\nIn this instance, we do not need \"TRUE \\~\" since we cover all `case_when()` options above. But in other cases, you may need it. \"TRUE \\~\" basically helps you assign a new value for every other condition that is not mentioned above.\n\nWe can create a table using the `table()` function for the trade status of Korea since 1965.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(trade$trade_status)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nbalanced  deficit  surplus  unknown \n     143     3134     6567     5444 \n```\n\n\n:::\n:::\n\n\n\n## Merging datasets\n\nRight now, we only have one dataset. Let's get another dataset from the `WDI` package, which includes World Bank's World Development Indicators data. Let's install the package if you do not have it yet.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"WDI\") # if you haven't installed the WDI package yet, remove the # sign.\n\nlibrary(WDI) # load the WDI package\n```\n:::\n\n\n\nLet's get the data for the GDP of all countries since 1965. You can search for indicators from the World Bank's World Development Indicators database [here](https://databank.worldbank.org/source/world-development-indicators) or using the `WDIsearch` function in the `WDI` package. For details, you can check out `WDI`'s documentation using the `?` function or [its Github page](https://github.com/vincentarelbundock/WDI).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwdi <- WDI(country = \"all\", # all countries\n           indicator = c(\"gdp\" = \"NY.GDP.MKTP.KD\", # GDP at constant 2015 US dollars\n                         \"gdp_pc\" = \"NY.GDP.PCAP.KD\"), # GDP per capita at constant 2015 US dollars \n           start = 1965, # start year\n           end = 2024, # end year\n           extra = TRUE, # include extra columns included in the WDI package defaults\n           language = \"en\" # language is English\n           )\n\nhead(wdi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      country iso2c iso3c year status lastupdated        gdp   gdp_pc\n1 Afghanistan    AF   AFG 1965         2024-09-19         NA       NA\n2 Afghanistan    AF   AFG 2003         2024-09-19 7867263256 347.4152\n3 Afghanistan    AF   AFG 1966         2024-09-19         NA       NA\n4 Afghanistan    AF   AFG 2005         2024-09-19 8874480196 363.5415\n5 Afghanistan    AF   AFG 1971         2024-09-19         NA       NA\n6 Afghanistan    AF   AFG 2002         2024-09-19 7228795919 344.2242\n      region capital longitude latitude     income lending\n1 South Asia   Kabul   69.1761  34.5228 Low income     IDA\n2 South Asia   Kabul   69.1761  34.5228 Low income     IDA\n3 South Asia   Kabul   69.1761  34.5228 Low income     IDA\n4 South Asia   Kabul   69.1761  34.5228 Low income     IDA\n5 South Asia   Kabul   69.1761  34.5228 Low income     IDA\n6 South Asia   Kabul   69.1761  34.5228 Low income     IDA\n```\n\n\n:::\n:::\n\n\n\nWe wanted extra WDI data, but we don't need all. Let's select the ones we need. This time, let's exclude the columns we do not need by using the `-` sign. Then let's exclude non-country groups (e.g., \"High income\", \"Not classified\") by filtering out rows where the `iso3c` column is missing. Then let's arrange the data by country code and year.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwdi <- wdi |>\n  #select(-iso2c, -status, -lastupdated, -capital, -lending, -longitude, -latitude) |> # exclude these columns\n  filter(!is.na(iso3c)) |> # exclude the rows that are missing country codes (in other words, we only include the ones that are not (!) missing country codes (iso3c))\n  arrange(iso3c, year) # arrange the data by country code and year\n\nhead(wdi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              country iso2c iso3c year status lastupdated          gdp\n1         High income    XD       1965         2024-09-19 1.214382e+13\n2          Low income    XM       1965         2024-09-19           NA\n3 Lower middle income    XN       1965         2024-09-19 5.474380e+11\n4      Not classified    XY       1965         2024-09-19           NA\n5 Upper middle income    XT       1965         2024-09-19 1.481616e+12\n6         High income    XD       1966         2024-09-19 1.281436e+13\n      gdp_pc region capital longitude latitude income lending\n1 12593.9054   <NA>    <NA>      <NA>     <NA>   <NA>    <NA>\n2         NA   <NA>    <NA>      <NA>     <NA>   <NA>    <NA>\n3   584.5733   <NA>    <NA>      <NA>     <NA>   <NA>    <NA>\n4         NA   <NA>    <NA>      <NA>     <NA>   <NA>    <NA>\n5  1171.4299   <NA>    <NA>      <NA>     <NA>   <NA>    <NA>\n6 13154.2957   <NA>    <NA>      <NA>     <NA>   <NA>    <NA>\n```\n\n\n:::\n:::\n\n\n\nThis did not work out. Probably these entries are not missing, but instead simply empty! Let's check that. Let's try filtering out empty country codes (instead of missing country codes which we checked with `is.na()`).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwdi <- wdi |>\n  filter(iso3c != \"\") # exclude the rows that have empty country codes. We check it as an empty character. \"!=\" means not equal to.\n\nhead(wdi)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  country iso2c iso3c year status lastupdated gdp gdp_pc\n1   Aruba    AW   ABW 1965         2024-09-19  NA     NA\n2   Aruba    AW   ABW 1966         2024-09-19  NA     NA\n3   Aruba    AW   ABW 1967         2024-09-19  NA     NA\n4   Aruba    AW   ABW 1968         2024-09-19  NA     NA\n5   Aruba    AW   ABW 1969         2024-09-19  NA     NA\n6   Aruba    AW   ABW 1970         2024-09-19  NA     NA\n                     region    capital longitude latitude      income\n1 Latin America & Caribbean Oranjestad  -70.0167  12.5167 High income\n2 Latin America & Caribbean Oranjestad  -70.0167  12.5167 High income\n3 Latin America & Caribbean Oranjestad  -70.0167  12.5167 High income\n4 Latin America & Caribbean Oranjestad  -70.0167  12.5167 High income\n5 Latin America & Caribbean Oranjestad  -70.0167  12.5167 High income\n6 Latin America & Caribbean Oranjestad  -70.0167  12.5167 High income\n         lending\n1 Not classified\n2 Not classified\n3 Not classified\n4 Not classified\n5 Not classified\n6 Not classified\n```\n\n\n:::\n:::\n\n\n\nYes, that was it. Instead of NA, those country code columns were empty for those rows. Now that we successfully filtered out the rows with empty country codes, let's join Korea's trade data with the WDI data. There are different types of joins. I will explain five of them. To make things easier, I will create smaller datasets for the demonstration. We will have only the data for the United States, China, and Japan in the trade data. We will have only the data for the United States, Japan and Italy in the WDI data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_df <- trade |>\n  filter(iso3c %in% c(\"USA\", \"CHN\", \"JPN\"))\n\nhead(trade_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 7\n  iso3c country  year export_kosis import_kosis  trade_kosis trade_status\n  <chr> <chr>   <dbl>        <dbl>        <dbl>        <dbl> <chr>       \n1 CHN   China    2023 124817682000 142857338000 267675020000 deficit     \n2 CHN   China    2022 155789389000 154576314000 310365703000 surplus     \n3 CHN   China    2021 162912974000 138628127000 301541101000 surplus     \n4 CHN   China    2020 132565445000 108884645000 241450090000 surplus     \n5 CHN   China    2019 136202533000 107228736000 243431269000 surplus     \n6 CHN   China    2018 162125055000 106488592000 268613647000 surplus     \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwdi_df <- wdi |>\n  filter(iso3c %in% c(\"USA\", \"JPN\", \"ITA\"))\n```\n:::\n\n\n\n![Dataframes](additional/dataframes.png)\n\n### inner_join\n\n`inner_join` returns only the rows that have matching values in both datasets. Let's join the `trade_df` and `wdi_df` datasets using the `iso3c` and `year` columns.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninner_df <- inner_join(trade_df, wdi_df, by = c(\"iso3c\", \"year\"))\n\n# you can also write it like this:\n\n# inner_df <- trade_df |> inner_join(wdi_df, by = c(\"iso3c\", \"year\"), suffix = c(\"_trade\", \"_wdi\"))\n\n\nhead(inner_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 19\n  iso3c country.x  year export_kosis import_kosis trade_kosis trade_status\n  <chr> <chr>     <dbl>        <dbl>        <dbl>       <dbl> <chr>       \n1 JPN   Japan      2023  29000616000  47656468000 76657084000 deficit     \n2 JPN   Japan      2022  30606278000  54711795000 85318073000 deficit     \n3 JPN   Japan      2021  30061806000  54642165000 84703971000 deficit     \n4 JPN   Japan      2020  25097651000  46023036000 71120687000 deficit     \n5 JPN   Japan      2019  28420213000  47580853000 76001066000 deficit     \n6 JPN   Japan      2018  30528580000  54603749000 85132329000 deficit     \n# i 12 more variables: country.y <chr>, iso2c <chr>, status <chr>,\n#   lastupdated <chr>, gdp <dbl>, gdp_pc <dbl>, region <chr>, capital <chr>,\n#   longitude <chr>, latitude <chr>, income <chr>, lending <chr>\n```\n\n\n:::\n:::\n\n\n\n![inner_join](additional/inner_join2.png)\n\nThe column names that we will join by are the same in both dataframes (\"iso3c\" and \"year\"). If it was not the same, we could write the code as follows:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninner_df <- inner_join(trade_df, wdi_df, by = c(\"iso3c\" = \"iso3c\", \"year\" = \"year\")) # the first element is from the first dataframe and the second element is from the second dataframe.\n```\n:::\n\n\n\nIf, for example, the country code column name was \"country_code\" and the year column was \"Year\" in `trade_df`, you would replace the first \"iso3c\" with \"country_code\" and the first \"year\" with \"Year\".\n\nIf there are columns with the same name in both dataframes other than the columns you use to join them, you can use the `suffix` argument to add a suffix to the column names. For example, in this case, we have columns named \"country\" in both dataframes. Since we didn't have suffix in the above code, we have two columns \"country.x\" and \"country.y\". If you want to add suffices, you can do it as follows:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninner_df <- inner_join(trade_df, wdi_df, by = c(\"iso3c\", \"year\"), suffix = c(\"_trade\", \"_wdi\"))\n\nhead(inner_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 19\n  iso3c country_trade  year export_kosis import_kosis trade_kosis trade_status\n  <chr> <chr>         <dbl>        <dbl>        <dbl>       <dbl> <chr>       \n1 JPN   Japan          2023  29000616000  47656468000 76657084000 deficit     \n2 JPN   Japan          2022  30606278000  54711795000 85318073000 deficit     \n3 JPN   Japan          2021  30061806000  54642165000 84703971000 deficit     \n4 JPN   Japan          2020  25097651000  46023036000 71120687000 deficit     \n5 JPN   Japan          2019  28420213000  47580853000 76001066000 deficit     \n6 JPN   Japan          2018  30528580000  54603749000 85132329000 deficit     \n# i 12 more variables: country_wdi <chr>, iso2c <chr>, status <chr>,\n#   lastupdated <chr>, gdp <dbl>, gdp_pc <dbl>, region <chr>, capital <chr>,\n#   longitude <chr>, latitude <chr>, income <chr>, lending <chr>\n```\n\n\n:::\n:::\n\n\n\n### left_join\n\n`left_join` returns all the rows from the left dataset and the matched rows from the right dataset. If there is no match, the result is `NA`. Let's join the `trade_df` and `wdi_df` datasets using the `iso3c` and `year` columns.\n\n![left_join](additional/left_join2.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleft_df <- left_join(trade_df, wdi_df, by = c(\"iso3c\", \"year\"))\n\nhead(left_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 19\n  iso3c country.x  year export_kosis import_kosis  trade_kosis trade_status\n  <chr> <chr>     <dbl>        <dbl>        <dbl>        <dbl> <chr>       \n1 CHN   China      2023 124817682000 142857338000 267675020000 deficit     \n2 CHN   China      2022 155789389000 154576314000 310365703000 surplus     \n3 CHN   China      2021 162912974000 138628127000 301541101000 surplus     \n4 CHN   China      2020 132565445000 108884645000 241450090000 surplus     \n5 CHN   China      2019 136202533000 107228736000 243431269000 surplus     \n6 CHN   China      2018 162125055000 106488592000 268613647000 surplus     \n# i 12 more variables: country.y <chr>, iso2c <chr>, status <chr>,\n#   lastupdated <chr>, gdp <dbl>, gdp_pc <dbl>, region <chr>, capital <chr>,\n#   longitude <chr>, latitude <chr>, income <chr>, lending <chr>\n```\n\n\n:::\n:::\n\n\n\n### right_join\n\n`right_join` returns all the rows from the right dataset and the matched rows from the left dataset. If there is no match, the result is `NA`. Let's join the `trade_df` and `wdi_df` datasets using the `iso3c` and `year` columns.\n\n![right_join](additional/right_join2.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nright_df <- right_join(trade_df, wdi_df, by = c(\"iso3c\", \"year\"), suffix = c(\"_trade\", \"_wdi\"))\n\nhead(right_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 19\n  iso3c country_trade  year export_kosis import_kosis trade_kosis trade_status\n  <chr> <chr>         <dbl>        <dbl>        <dbl>       <dbl> <chr>       \n1 JPN   Japan          2023  29000616000  47656468000 76657084000 deficit     \n2 JPN   Japan          2022  30606278000  54711795000 85318073000 deficit     \n3 JPN   Japan          2021  30061806000  54642165000 84703971000 deficit     \n4 JPN   Japan          2020  25097651000  46023036000 71120687000 deficit     \n5 JPN   Japan          2019  28420213000  47580853000 76001066000 deficit     \n6 JPN   Japan          2018  30528580000  54603749000 85132329000 deficit     \n# i 12 more variables: country_wdi <chr>, iso2c <chr>, status <chr>,\n#   lastupdated <chr>, gdp <dbl>, gdp_pc <dbl>, region <chr>, capital <chr>,\n#   longitude <chr>, latitude <chr>, income <chr>, lending <chr>\n```\n\n\n:::\n:::\n\n\n\n### full_join\n\n`full_join` returns all the rows from both datasets. If there is no match, the result is `NA`. Let's join the `trade_df` and `wdi_df` datasets using the `iso3c` and `year` columns.\n\n![full_join](additional/full_join2.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_df <- full_join(trade_df, wdi_df, by = c(\"iso3c\", \"year\"), suffix = c(\"_trade\", \"_wdi\"))\n\nhead(full_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 19\n  iso3c country_trade  year export_kosis import_kosis  trade_kosis trade_status\n  <chr> <chr>         <dbl>        <dbl>        <dbl>        <dbl> <chr>       \n1 CHN   China          2023 124817682000 142857338000 267675020000 deficit     \n2 CHN   China          2022 155789389000 154576314000 310365703000 surplus     \n3 CHN   China          2021 162912974000 138628127000 301541101000 surplus     \n4 CHN   China          2020 132565445000 108884645000 241450090000 surplus     \n5 CHN   China          2019 136202533000 107228736000 243431269000 surplus     \n6 CHN   China          2018 162125055000 106488592000 268613647000 surplus     \n# i 12 more variables: country_wdi <chr>, iso2c <chr>, status <chr>,\n#   lastupdated <chr>, gdp <dbl>, gdp_pc <dbl>, region <chr>, capital <chr>,\n#   longitude <chr>, latitude <chr>, income <chr>, lending <chr>\n```\n\n\n:::\n:::\n\n\n\n### anti_join\n\n`anti_join` returns all the rows from the left dataset that do not have a match in the right dataset. Let's join the `trade_df` and `wdi_df` datasets using the `iso3c` and `year` columns.\n\n![anti_join](additional/anti_join2.png)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanti_df <- anti_join(trade_df, wdi_df, by = c(\"iso3c\", \"year\"))\n\nhead(anti_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 x 7\n  iso3c country  year export_kosis import_kosis  trade_kosis trade_status\n  <chr> <chr>   <dbl>        <dbl>        <dbl>        <dbl> <chr>       \n1 CHN   China    2023 124817682000 142857338000 267675020000 deficit     \n2 CHN   China    2022 155789389000 154576314000 310365703000 surplus     \n3 CHN   China    2021 162912974000 138628127000 301541101000 surplus     \n4 CHN   China    2020 132565445000 108884645000 241450090000 surplus     \n5 CHN   China    2019 136202533000 107228736000 243431269000 surplus     \n6 CHN   China    2018 162125055000 106488592000 268613647000 surplus     \n```\n\n\n:::\n:::\n\n\n\n## A Note on Country Codes\n\nIt is often easier to work with standard country codes than country names when we work with multiple datasets. There are a few widely used standard country codes. Above, we used the ISO 3166-1 alpha-3 country codes. There are other commonly used country codes such as Correlates of War (COW) country codes, Varieties of Democracy (V-Dem) country codes, and more.\n\nWe can convert country names to country codes using the `countrycode` package. Let's install the package if you do not have it yet.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"countrycode\") # if you haven't installed the countrycode package yet, remove the # sign.\n\nlibrary(countrycode) # load the countrycode package\n```\n:::\n\n\n\nLet's convert the country names in the `trade_df` dataset to Correlates of War country codes. You can find the `countrycode` documentantion on its [Github page](https://github.com/vincentarelbundock/countrycode) or by using the `?` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ?countrycode\n\ntrade_df <- trade_df |>\n  mutate(cown = countrycode(country, origin = \"country.name\", destination = \"cown\")) # convert country names to Correlates of War numeric country codes (cown)\n```\n:::\n\n\n\n## A Note on Working with Korean Country Names[^wrangling-1]\n\n[^wrangling-1]: This subsection is adapted from the [vignette](https://kdiplo.com/articles/iso3c_kr-vignette) of the `iso3c_kr` function in the `kdiplo` package.\n\nIn my research, I often work with country-year data from Korean sources, including data on diplomatic visits, trade, aid and so on. One of the fundamental difficulties I have had is the lack of universal country codes across different datasets. Further complicating matters is the inconsistency of country names in these datasets. For example, Democratic Republic of the Congo has five different spellings across different official sources that I could find: 콩고 민주공화국, 자이르, 콩고민주공화국, 콩고 민주 공화국, 콩고민주공화국(DR콩고).\n\nTo address this issue, I have created a function in my `kdiplo` package that converts Korean country names into ISO 3166-1 alpha-3 (*iso3c*) country codes. This function, `iso3c_kr`, is designed to assign universal iso3c country codes to Korean-language country names that will make it easier to join different kinds of data.\n\nOne still needs to check if the output is correct, especially for countries that have gone through political transitions such as Germany, Yugoslavia, Russia, Vietnam, Yemen and so on.\n\nSometimes the Korean government sources have overlapping data for Yugoslavia and Serbia, for example. In such cases, one needs to check the data and make sure that the data is correct.\n\nFor example, the following is sample Korean trade data from [Korean Statistical Information Service (KOSIS)](https://kosis.kr/statHtml/statHtml.do?orgId=360&tblId=DT_1R11006_FRM101&conn_path=I3):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"readxl\") # if you haven't installed the readxl package yet, remove the # sign.\n\nlibrary(readxl) # load the readxl package\n\n# let's read the xlsx data\n\nkosis_trade <- read_xlsx(\"data/kosis_trade_240330.xlsx\")\n\n# let's take a look at the data\n\n# install.packages(\"gt\") # if you haven't installed the gt package yet, remove the # sign.\n\n# let's take a look at some of the data\n\n# remember, [row, column] format can be used in R for subsetting dataframes. So, we can look at rows 533 to 538 and columns 1 and 57 to 62.\n\nkosis_trade[533:538,c(1,57:62)] |> gt::gt() \n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lrrrrrr}\n\\toprule\n국가별 & 2018 년 & 2019 년 & 2020 년 & 2021 년 & 2022 년 & 2023 년 \\\\ \n\\midrule\\addlinespace[2.5pt]\n잠비아 & 26241 & 16087 & 17619 & 28356 & 14068 & 15459 \\\\ \n잠비아 & 108344 & 54542 & 15164 & 100606 & 82198 & 53867 \\\\ \n자이르 & NA & NA & NA & NA & NA & NA \\\\ \n자이르 & 618 & 8 & 113 & 4 & NA & NA \\\\ \n짐바브웨 & 25964 & 14088 & 15514 & 20404 & 16083 & 19563 \\\\ \n짐바브웨 & 4909 & 13098 & 11377 & 9627 & 10415 & 20862 \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n\n```{.r .cell-code}\n# you can use the gt package to create a table.\n# you can use \"::\" to access the functions in the package without loading the package.\n```\n:::\n\n\n\nAnd, the following is sample Korean aid data from [Korea's ODA portal](https://stats.odakorea.go.kr/portal/odakorea/detail):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naid <- read_xlsx(\"data/korea_total_aid_2019_230709.xlsx\")\n\n\naid <- aid |> select(1:5) # we only need the first five columns\n\naid <- aid |> set_names(c(\"country_kr\", \"sector\", \"no_of_projects\", \"aid_usd\", \"aid_krw\"))\n\n# This sample data is only 2019; so we will add the year column, and assign 2019 to all rows.\n\naid$year <- 2019\n\n# let's take a look at some of the data\naid[c(50, 150, 250, 350, 450),] |> gt::gt()\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{llrrrr}\n\\toprule\ncountry\\_kr & sector & no\\_of\\_projects & aid\\_usd & aid\\_krw & year \\\\ \n\\midrule\\addlinespace[2.5pt]\n베트남 & 통신정책, 계획 및 행정(voluntary code) & 2 & 232334 & 270736486 & 2019 \\\\ \n캄보디아 & 11321 & 1 & 85815 & 99999361 & 2019 \\\\ \n미얀마 & 사회보호/보장 & 1 & 103460 & 120560903 & 2019 \\\\ \n라오스 & 비정규 농업훈련 & 1 & 107958 & 125802378 & 2019 \\\\ \n몽골 & 의료서비스 & 5 & 511824 & 596423389 & 2019 \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\n### Converting wide data to long format\n\nWide format is quite common in official Korean data sources. Trade data is in wide format. Before using the `iso3c_kr` function, let's first transform the trade data into a long (country-year) format to make it in the same format as the aid data. This will make joining the two datasets more feasible.\n\nTo convert the trade data into a long format, we will use the `pivot_longer()` function from the `tidyr` package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# we will divide the trade data into export and import data\n\nexport <- kosis_trade \n\nimport <- kosis_trade\n```\n:::\n\n\n\nIn `pivot_longer()`, we need to specify the columns that we want to pivot. In this case, we want to pivot columns 4 to 62, which are years. We also need to specify the names of the columns that will be created. In this case, we will create a column called `year` and a column called `export_kosis` for the export data. We will create a column called `year` and a column called `import_kosis` for the import data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexport_long <- export |> \n  pivot_longer(4:62, names_to = \"year\", values_to = \"export_kosis\") # we will pivot the data from wide to long format\n```\n:::\n\n\n\nWe can rename the columns using `set_names` function in `rlang` package, which is also a member of the `tidyverse` family, to make them more informative.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexport_long <- export_long |> \n  set_names(c(\"country_kr\", \"type\", \"unit\", \"year\", \"export_kosis\"))\n```\n:::\n\n\n\nWe can filter the data for only export data using the `filter()` function. We can also convert the export data from thousands of dollars to dollars by multiplying the `export_kosis` column by 1000. We can also convert the `year` column to numeric using the `parse_number()` function from the `readr` package, which is also a member of the `tidyverse` family.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexport_long <- export_long |>\n  filter(type == \"수출액[천달러]\") |> # we only need the export data which has the column name in Korean as \"수출액[천달러]\"\n  mutate(export_kosis = parse_number(export_kosis) * 1000, # we convert the export data from thousands of dollars to dollars; sometimes there are commas that make the data character instead of numeric. So we use parse_number() function from the readr package to convert character to numeric data.\n         year = parse_number(year)) |> # we convert the year column to numeric using parse_number() function from the readr package\n  select(-type, -unit) # we do not need the type and unit columns\n```\n:::\n\n\n\nWe repeat the same steps for the import data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimport_long <- import |> \n  pivot_longer(4:62, names_to = \"year\", values_to = \"import_kosis\")\n\nimport_long <- import_long |> \n  set_names(c(\"country_kr\", \"type\", \"unit\", \"year\", \"import_kosis\"))\n\n\nimport_long <- import_long |>\n  filter(type == \"수입액[천달러]\") |> \n  mutate(import_kosis = parse_number(import_kosis) * 1000,\n         year = parse_number(year)) |>\n  select(-type, -unit)\n```\n:::\n\n\n\nNow, we can join the export and import data using the `left_join()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_long <- export_long |> \n  left_join(import_long, by = c(\"country_kr\", \"year\"))\n```\n:::\n\n\n\nHere, we get a warning message that there are rows that have the same country name and year in both the export and import data. It is because, KOSIS reported trade with Palestine in two separate entries (probably, West Bank and Gaza are recorded separately), but assigning both the same name \"팔레스타인 해방기구\". We will ignore this warning for now.\n\n### `iso3c_kr` function to convert Korean country names to iso3c country codes\n\nUsing the `iso3c_kr` function, we can simply convert Korean country names into iso3c country codes. For example, the following is the output of the `iso3c_kr` function for the Korean trade data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_long <- iso3c_kr(trade_long, \"country_kr\") #you copy paste the column name that has the Korean country names.\n\ntrade_long[c(50, 150, 250, 350, 450, 550), c(1,5, 2:4)] |> gt::gt()\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{llrrr}\n\\toprule\ncountry\\_kr & iso3c & year & export\\_kosis & import\\_kosis \\\\ \n\\midrule\\addlinespace[2.5pt]\n계 & NA & 2014 & 572664607000 & 525514506000 \\\\ \n아랍에미리트 연합 & ARE & 1996 & 1377933000 & 2259205000 \\\\ \n앤티가바부다 & ATG & 1978 & NA & NA \\\\ \n앵귈라 & AIA & 2019 & 817000 & 1000 \\\\ \n아르메니아 & ARM & 2001 & 1255000 & 43000 \\\\ \n앙골라 & AGO & 1983 & 235000 & NA \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\nWe see that in this example, \"계\" (*gyae*) did not get any iso3c country code. This is because the `iso3c_kr` function could not find the iso3c country code for this entry. This is because, it is not a country name. \"계\" means total. It is best to check the data to see which entries did not get an iso3c code.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmissing_iso3c <- trade_long |> \n  filter(is.na(iso3c)) |> # we only need the rows that do not have iso3c country codes\n  pull(country_kr) |> # pull() function is used to extract a column as a vector\n  unique() # we need each Korean country name only once to see which ones are missing rather than having it for all years.\n\nmissing_iso3c\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"계\"           \"국제통화기금\" \"기타\"         \"기타국\"      \n```\n\n\n:::\n:::\n\n\n\nThey mean \"total\", \"IMF\", \"other\", and \"other countries\" in Korean. In other words, we are not missing any countries, which is good.\n\nNow let's convert the Korean country names in the aid data into iso3c country codes:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naid <- iso3c_kr(aid, \"country_kr\") #you copy paste the column name that has the Korean country names.\n\naid[c(50, 150, 250, 350, 450, 550),c(1, 6, 2:5)] |> gt::gt()\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lrlrrr}\n\\toprule\ncountry\\_kr & year & sector & no\\_of\\_projects & aid\\_usd & aid\\_krw \\\\ \n\\midrule\\addlinespace[2.5pt]\n베트남 & 2019 & 통신정책, 계획 및 행정(voluntary code) & 2 & 232334 & 270736486 \\\\ \n캄보디아 & 2019 & 11321 & 1 & 85815 & 99999361 \\\\ \n미얀마 & 2019 & 사회보호/보장 & 1 & 103460 & 120560903 \\\\ \n라오스 & 2019 & 비정규 농업훈련 & 1 & 107958 & 125802378 \\\\ \n몽골 & 2019 & 의료서비스 & 5 & 511824 & 596423389 \\\\ \n필리핀 & 2019 & 농업용수자원 & 2 & 0 & 0 \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\nOnce you know the iso3c country codes, you can get the English country names, or other country codes (such as Correlates of War country codes) using the `countrycode` package, for example.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_long <- trade_long |> \n  mutate(country_name = countrycode::countrycode(iso3c, origin = \"iso3c\", destination = \"country.name\"))\n\ntrade_long[c(50, 150, 250, 350, 450, 550),c(1, 5, 6, 2:4)] |> gt::gt()\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lllrrr}\n\\toprule\ncountry\\_kr & iso3c & country\\_name & year & export\\_kosis & import\\_kosis \\\\ \n\\midrule\\addlinespace[2.5pt]\n계 & NA & NA & 2014 & 572664607000 & 525514506000 \\\\ \n아랍에미리트 연합 & ARE & United Arab Emirates & 1996 & 1377933000 & 2259205000 \\\\ \n앤티가바부다 & ATG & Antigua \\& Barbuda & 1978 & NA & NA \\\\ \n앵귈라 & AIA & Anguilla & 2019 & 817000 & 1000 \\\\ \n아르메니아 & ARM & Armenia & 2001 & 1255000 & 43000 \\\\ \n앙골라 & AGO & Angola & 1983 & 235000 & NA \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\nMore importantly, `iso3c_kr` function allows users to be able to join different datasets that have Korean country names. For example, one can join the trade data with the aid data using the iso3c country codes. In this example, I will join the trade data with the aid data using the iso3c country codes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade_aid <- trade_long |> \n  left_join(aid, by = c(\"iso3c\", \"year\"), suffix = c(\"_trade\", \"_aid\"))\n\ntrade_aid |>\n  filter(year == 2019 & !is.na(iso3c)) |> # just as a sample, we only need the data for 2019 and we exclude the rows that do not have iso3c country codes\n  slice(c(30, 130, 230, 330, 430, 530)) |> # just as a sample, let's only look at the rows 30, 130, 230, 330, 430, and 530\n  select(c(iso3c, country_kr_trade, country_kr_aid, year, export_kosis, import_kosis, aid_usd)) |> # just as a sample, let's only look at the columns that we are interested in\n  gt::gt()\n```\n\n::: {.cell-output-display}\n\\begin{longtable}{lllrrrr}\n\\toprule\niso3c & country\\_kr\\_trade & country\\_kr\\_aid & year & export\\_kosis & import\\_kosis & aid\\_usd \\\\ \n\\midrule\\addlinespace[2.5pt]\nAFG & 아프가니스탄 & 아프가니스탄 & 2019 & 49930000 & 38000 & 6081 \\\\ \nBGD & 방글라데시 & 방글라데시 & 2019 & 1282342000 & 404703000 & 746593 \\\\ \nBOL & 볼리비아 & 볼리비아 & 2019 & 30434000 & 450576000 & 535262 \\\\ \nCOD & 콩고 민주공화국 & 콩고민주공화국(DR콩고) & 2019 & 37083000 & 411274000 & 0 \\\\ \nCHN & 중국 & 중국 & 2019 & 136202533000 & 107228736000 & 0 \\\\ \nDOM & 도미니카 공화국 & 도미니카공화국 & 2019 & 252420000 & 88516000 & 25792 \\\\ \n\\bottomrule\n\\end{longtable}\n\n:::\n:::\n\n\n\nVoilà! Now we have a dataset that has both trade and aid data, both of which originally did not have consistent country names or country codes. If we only used `country_kr` column to join the two datasets, we would have failed to merge all the data, such as \"콩고 민주공화국\" and\t\"콩고민주공화국(DR콩고)\", both of which are Democratic Republic of the Congo; or \"도미니카 공화국\"\tand \"도미니카공화국\" (Dominican Republic) which merelt have a space difference between the words. But with the `iso3c_kr` function, we were able to merge the two datasets successfully.\n\n## Working with dates\n\n**To be added**\n",
    "supporting": [
      "wrangling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"unnamed-chunk-43\",\"unnamed-chunk-43\",\"unnamed-chunk-43\",\"unnamed-chunk-43\",\"unnamed-chunk-43\",\"unnamed-chunk-44\",\"unnamed-chunk-44\",\"unnamed-chunk-44\",\"unnamed-chunk-44\",\"unnamed-chunk-44\",\"unnamed-chunk-51\",\"unnamed-chunk-51\",\"unnamed-chunk-51\",\"unnamed-chunk-51\",\"unnamed-chunk-51\",\"unnamed-chunk-53\",\"unnamed-chunk-53\",\"unnamed-chunk-53\",\"unnamed-chunk-53\",\"unnamed-chunk-53\",\"unnamed-chunk-54\",\"unnamed-chunk-54\",\"unnamed-chunk-54\",\"unnamed-chunk-54\",\"unnamed-chunk-54\",\"unnamed-chunk-55\",\"unnamed-chunk-55\",\"unnamed-chunk-55\",\"unnamed-chunk-55\",\"unnamed-chunk-55\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}