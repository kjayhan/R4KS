{
  "hash": "7c899d4a726c9a5565688df7f4b1da90",
  "result": {
    "engine": "knitr",
    "markdown": "# Data Visualization: Plots\n\n[A Very Early Draft]\n\nIn this chapter, we will learn data visualization using the `ggplot2` package, which is part of the `tidyverse` family. We will learn how to create scatter plots, line plots, bar plots, and histograms. We will also learn how to customize the appearance of these plots. Since this is a beginner's guide, we will only cover the very basics of data visualization.\n\nFor more advanced topics, please refer to the official documentation of the [`ggplot2`](https://ggplot2.tidyverse.org/) package. You can also check out the cheat sheet for `ggplot2` [here](https://rstudio.github.io/cheatsheets/html/data-visualization.html). You can find other R cheat sheets [here](https://rstudio.github.io/cheatsheets/).\n\nBefore we begin, I would like to emphasize that learning how to create plots is important, but learning which plot to use when is equally important. I am not covering the latter here, but there are some great books and resources available that can help you with that, including\n\n[ggplot2 (3e)](https://ggplot2-book.org/)\n\n[Data Visualization: A Practical Introduction](https://socviz.co/)\n\n[Modern Data Visualization with R](https://rkabacoff.github.io/datavis/)\n\n[Visual Vocabulary](https://ft-interactive.github.io/visual-vocabulary/)\n\n[The R Graph Gallery](https://www.r-graph-gallery.com/)\n\n[Dataviz Project](https://datavizproject.com/)\n\n[Friends Don't Let Friends Make Bad Graphs](https://github.com/cxli233/FriendsDontLetFriends)\n\nLet's get started by loading the `tidyverse` package, which automatically loads the `ggplot2` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # Load the tidyverse package\n\n# install.packages(\"devtools\") # if you haven't installed the devtools package yet, remove the # sign.\n\n# devtools::install_github(\"kjayhan/kdiplo\") # if you haven't installed the kdiplo package yet, remove the # sign.\n\nlibrary(kdiplo) # Load the kdiplo package\n```\n:::\n\n\nWe will work with the Korean trade data, and some additional data, which we have already cleaned and prepared in the [previous chapter](wrangling.qmd). I copy paste the same code here for your convenience.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrade <- kdiplo::trade_data |> # making sure that we get trade_data from the kdiplo package, and not from the environment.\n  select(iso3c, country, year, export_kosis, import_kosis) |> # select columns iso3c, country, year, export_kosis, and import_kosis\n  filter(year > 1964) |> # filter rows where year is greater than 1964\n  mutate(trade_kosis = export_kosis + import_kosis) # create a new column trade_kosis for Korea's trade volume, which is the sum of export_kosis and import_kosis\n  \n# install.packages(\"WDI\") # if you haven't installed the WDI package yet, remove the # sign.\n\nlibrary(WDI) # load the WDI package\n\nwdi <- WDI(country = \"all\", # all countries\n           indicator = c(\"gdp\" = \"NY.GDP.MKTP.KD\", # GDP at constant 2015 US dollars\n                         \"gdp_pc\" = \"NY.GDP.PCAP.KD\"), # GDP per capita at constant 2015 US dollars \n           start = 1965, # start year\n           end = 2024, # end year\n           extra = TRUE, # include extra columns included in the WDI package defaults\n           language = \"en\" # language is English\n           ) |>\n    select(-iso2c, -status, -lastupdated, -capital, -lending, -longitude, -latitude, -country) |> # exclude these columns\n  filter(iso3c != \"\" | is.na(iso3c)) # exclude the rows that are missing country codes\n  \n# let's join these two datasets.\n  \ndf <- trade |>\n  inner_join(wdi, by = c(\"iso3c\", \"year\")) # join the trade and wdi datasets by iso3c and year; let's keep only the rows that have matching iso3c and year values in both datasets.\n\nhead(df)  \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 10\n  iso3c country  year export_kosis import_kosis trade_kosis   gdp gdp_pc region \n  <chr> <chr>   <dbl>        <dbl>        <dbl>       <dbl> <dbl>  <dbl> <chr>  \n1 ABW   Aruba    1965           NA           NA          NA    NA     NA Latin …\n2 ABW   Aruba    1966           NA           NA          NA    NA     NA Latin …\n3 ABW   Aruba    1967           NA           NA          NA    NA     NA Latin …\n4 ABW   Aruba    1968           NA           NA          NA    NA     NA Latin …\n5 ABW   Aruba    1969           NA           NA          NA    NA     NA Latin …\n6 ABW   Aruba    1970           NA           NA          NA    NA     NA Latin …\n# ℹ 1 more variable: income <chr>\n```\n\n\n:::\n:::\n\n\n## Histograms\n\nA histogram is a graphical representation of the distribution of a continuous variable. It is a type of bar plot that shows the frequency of values in a dataset. The bars in a histogram are adjacent to each other, and the height of each bar represents the frequency of values in a specific range.\n\nTo create a histogram, we use the `geom_histogram()` function in `ggplot2`. Let's create a histogram of Korea's trade volume.\n\nIn ggplot2, we first specify the dataset and the aesthetic mappings using the `ggplot()` function. In `geom_histogram()`, we specify only the x-axis variable using the `aes()` function.\nWe then add layers to the plot using the `+` operator. We should be careful not to use a pipe (`|>` or `%>%`) instead of `+` operator within `ggplot()` calls. In this case, we specify the x-axis variable using the `aes()` function and add the `geom_histogram()` layer to create the histogram.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a histogram of Korea's trade volume\ndf |>\n  filter(year == 2023) |> # filter rows to include only the year 2023\n  ggplot(aes(x = trade_kosis)) + # specify the x-axis variable\n  geom_histogram() # create a histogram\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nThis is not very useful as a histogram because of the skewed distribution of the trade volume. We can improve the appearance of the histogram by using log transformation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a histogram of Korea's trade volume with log transformation and assign it to an object\n\nhist1 <- df |>\n  filter(year == 2023) |> # filter rows to include only the year 2023\n  ggplot(aes(x = log(trade_kosis))) + # specify the x-axis variable with log transformation\n  geom_histogram(# you can specify the number of bins using the bins argument, e.g., bins = 20\n    fill = \"#2166ac\") # create a histogram with blue bars; you can change the color by specifying a different color code, or you can simply use the default color by not specifying the fill argument.\n\n\nhist1 # print the histogram\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThis is more informative than the previous histogram. This time let's add a vertical line to the histogram to show the mean and median of trade volume. We need to remember to use `na.rm = TRUE` in the `mean()` and `median()` functions to remove missing values from the calculation. Otherwise, the functions will return `NA`.\n\nWe can draw these vertical lines by adding the `geom_vline()` layer to the plot. We can also change the color of the line using the `color` arguments in the `geom_vline()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# since we are going to use the same histogram object, we can add layers to it. Let's call it hist2.\n\nhist2 <- hist1 +\n  geom_vline(aes(xintercept = log(mean(trade_kosis, na.rm = TRUE))), color = \"#b2182b\", linetype = \"dashed\") + # add a vertical line for the mean of trade volume\n  geom_vline(aes(xintercept = log(median(trade_kosis, na.rm = TRUE))), color = \"#fddbc7\", linetype = \"dotted\") # add a vertical line for the median of trade volume\n  \nhist2 # print the histogram\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nThe dashed line represents the mean of the trade volume, and the dotted line represents the median of the trade volume. The mean is greater than the median, which indicates that the distribution is right-skewed, with most values concentrated around the median, which is 17.9179225 (formula = `log(median(df$trade_kosis, na.rm = TRUE))`), which corresponds to 6.0486\\times 10^{7} (formula = `exp(log(median(df$trade_kosis, na.rm = TRUE)))`) in the original scale. `exp()` is the inverse of `log()`.\n\nWe can add a title, x-axis label, and y-axis label to the histogram using the `labs()` function. We can change the breaks and labels of the x-axis using the `scale_x_continuous()` function. We can also add annotations to the plot using the `annotate()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add a title, x-axis label, and y-axis label to the histogram\n\nhist3 <- hist2 +\n  labs(title = \"Histogram of Korea's Trade Volume in 2023\", x = \"Log of Trade Volume\", y = \"Frequency\") + # add a title, x-axis label, and y-axis label\n  scale_x_continuous(breaks = seq(0, 30, 2)) + # change the breaks of the x-axis\n  annotate(\"text\", x = log(median(df$trade_kosis, na.rm = TRUE)), y = 22, label = \"Median\", color = \"black\", size = 3) + # add an annotation for the median\n  annotate(\"text\", x = log(mean(df$trade_kosis, na.rm = TRUE)), y = 22, label = \"Mean\", color = \"black\", size = 3) # add an annotation for the mean\n\nhist3 # print the histogram\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nThis histogram is now more informative and visually appealing. We can also change the theme of the plot using the `theme_minimal()` function. For other themes, you can check out `ggtthemes` package as well as many others out there.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Change the theme of the histogram\n\nhist3 +\n  theme_minimal() # change the theme of the plot to minimal; you can also use other themes such as theme_light(), theme_dark(), and theme_bw().\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n  # theme_light() # change the theme of the plot to light\n  # theme_dark() # change the theme of the plot to dark\n  # theme_bw() # change the theme of the plot to black and white\n```\n:::\n\n\n## Bar Plots\n\nA bar plot is a graphical representation of the distribution of a categorical variable. It is a type of plot that shows the frequency of categories in a dataset. The bars in a bar plot are separated from each other, and the height of each bar represents the frequency of categories.\n\nTo create a bar plot, we use the `geom_bar()` function in `ggplot2`. Let's create a bar plot of Korea's trade volume by year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a bar plot of Korea's trade volume by year\n\nbar1 <- df |>\n  ggplot(aes(x = year, y = trade_kosis)) + # specify the x-axis and y-axis variables\n  geom_col(fill = \"#2166ac\") # create a bar plot with the actual values of trade volume\n\n# geom_col() is an alias for geom_bar(stat = \"identity\"), which is used when the y-axis variable represents the actual values of the data, not the frequency of the data.\n\nbar1 # print the bar plot\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nLet's customize the appearance by adding a title, x-axis label, and y-axis label, and changing the theme of the plot, and changing the scale of the x-axis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Customize the appearance of the bar plot\n\nbar2 <- bar1 +\n  labs(title = \"Korea's Trade Volume by Year\", x = \"Year\", y = \"Trade Volume\") + # add a title, x-axis label, and y-axis label\n  scale_x_continuous(breaks = seq(1965, 2023, 5)) + # change the breaks of the x-axis\n  theme_minimal() + # change the theme of the plot to minimal. Be careful here, if this theme_minimal() is the last layer, another change to theme which we make in the next line will not be applied.\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # change the angle and justification of the x-axis text\n\nbar2 # print the bar plot\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nThis bar plot is now more informative and visually appealing. \n\n## Line Plots\n\nA line plot is a graphical representation of the relationship between two continuous variables. It is a type of plot that shows the trend of a variable over time or another continuous variable. The lines in a line plot are connected, and the slope of each line represents the relationship between the variables.\n\nTo create a line plot, we use the `geom_line()` function in `ggplot2`. Let's create a line plot of Korea's total exports and total imports by year. Let's first group the data by year and calculate the total exports and total imports for each year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Group the data by year and calculate the total exports and total imports for each year\n\ndf_year <- df |>\n  group_by(year) |> # group the data by year\n  summarise(total_exports = sum(export_kosis, na.rm = TRUE), \n            total_imports = sum(import_kosis, na.rm = TRUE)) # calculate the total exports and total imports for each year\n```\n:::\n\n\nNow let's put imports and exports volume amounts into the same column, using the `pivot_longer()` function, which we learned in the [previous chapter](wrangling.qmd).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Put imports and exports volume amounts into the same column\n\ndf_year <- df_year |>\n  pivot_longer(cols = c(total_exports, total_imports), names_to = \"type\", values_to = \"volume\") # put imports and exports volume amounts into the same column\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a line plot of Korea's exports and imports by year\n\nline1 <- df_year |>\n  ggplot(aes(x = year, y = volume, color = type)) + # specify the x-axis variable\n  geom_line() + # create a line plot for exports\n  scale_color_manual(values = c(\"#2166ac\", \"#b2182b\")) + # change the colors of the lines\n  scale_x_continuous(breaks = seq(1965, 2023, 5)) + # change the breaks of the x-axis\n  labs(title = \"Korea's Import and Export Volume by Year\", x = \"Year\", y = \"Import/ Export Volume\", color = \"Trade Type\") + # add a title, x-axis label, and y-axis label +\n  theme_minimal() + # change the theme of the plot to minimal. Be careful here, if this theme_minimal() is the last layer, another change to theme which we make in the next line will not be applied.\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # change the angle and justification of the x-axis text\n\nline1 # print the line plot\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nThis line plot shows the trend of Korea's total exports and total imports over time. The blue line represents total exports, and the red line represents total imports.\n\n## Scatter Plots\n\nA scatter plot is a graphical representation of the relationship between two continuous variables. It is a type of plot that shows the correlation between two variables. The points in a scatter plot are not connected, and the position of each point represents the values of the variables.\n\nTo create a scatter plot, we use the `geom_point()` function in `ggplot2`. Let's create a scatter plot of logged GDP of Korea's trade partner and the bilateral logged trade volume. We take logs because of skewed distributions of both data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a scatter plot of partner country's logged GDP and bilateral logged trade volume\n\nscatter1 <- df |>\n  ggplot(aes(x = log(gdp), y = log(trade_kosis))) + # specify the x-axis and y-axis variables\n  geom_point(color = \"#2166ac\") + # create a scatter plot with blue points\n  labs(title = \"Logged GDP of the Partner Country and Logged Trade Volume\", x = \"Logged GDP\", y = \"Logged Trade Volume\") + # add a title, x-axis label, and y-axis label\n  theme_minimal() # change the theme of the plot to minimal\n\nscatter1 # print the scatter plot\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nTo this, we can add a linear regression line to show the relationship between the variables. We can do this by adding the `geom_smooth()` layer to the plot. We can also change the color of the line using the `color` argument in the `geom_smooth()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add a linear regression line to the scatter plot\n\nscatter2 <- scatter1 +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"#b2182b\") # add a linear regression line without confidence intervals\n\nscatter2 # print the scatter plot\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nThis scatter plot shows the relationship between the logged GDP of Korea's trade partner and the bilateral logged trade volume. The linear regression line indicates a positive relationship between the variables, as expected.\n\nNow let's differentiate the points by the income level of the partner country. We can do this by adding the `color` argument in the `aes()` function and specifying the `income` variable. \n\nFirst, let's see the categories and frequency of each category in the income variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check the categories in the income variable\n\ntable(df$income) # count the frequency of each category in the income variable\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n        High income          Low income Lower middle income      Not classified \n               4543                1652                3127                  59 \nUpper middle income \n               3134 \n```\n\n\n:::\n:::\n\nTo make the visual neat, we can group the income levels into three categories: low, middle, and high. We can do this by using the `case_when()` function in the `mutate()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Group the income levels into three categories: low, high, and not classified\n\ndf <- df |>\n  mutate(income2 = case_when(\n    income %in% c(\"Low income\") ~ \"Low income\", # if the income level is \"Low income\", assign it to the Low category\n    income %in% c(\"Lower middle income \", \"Upper middle income\") ~ \"Middle income\", # if the income level is \"Lower middle income \" or \"Upper middle income\", assign it to the Middle income category\n    income %in% c(\"High income\") ~ \"High income\", # if the income level is \"High income\", assign it to the High income category\n    TRUE ~ \"Not Classified\" # otherwise, assign it to the Not Classified category\n  ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Differentiate the points by the income level of the partner country\n\nscatter3 <- df |>\n  filter(income2 != \"Not Classified\" & year == 2023) |> # filter rows to exclude the Not Classified category; for now I also filter to year 2023 to make the regression lines more visible\n  ggplot(aes(x = log(gdp), y = log(trade_kosis), color = income2)) + # specify the x-axis and y-axis variables and differentiate the points by the income level\n  geom_point() + # create a scatter plot\n  labs(title = \"Logged GDP of the Partner Country and Logged Trade Volume by Income Level\", x = \"Logged GDP\", y = \"Logged Trade Volume\", color = \"Income Level\") + # add a title, x-axis label, y-axis label, and color legend\n  geom_smooth(method = \"lm\", se = FALSE) + # add a linear regression line without confidence intervals\n  scale_color_manual(values = c(\"#2166ac\", \"#f4a582\", \"#b2182b\")) + # change the colors of the points\n  theme_minimal() # change the theme of the plot to minimal\n\nscatter3 # print the scatter plot\n```\n\n::: {.cell-output-display}\n![](visuals-plots_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "visuals-plots_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}